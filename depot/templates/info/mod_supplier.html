{%extends parent_id|yesno:"inline_base.html,main_base.html"%}
{%load i18n%}
{%load url from future%}


{%block content%}
<div class="container-fluid">
	{%if not parent_id%}
	<div class="f-main">
		<div class="main-wrap-no-right">		
	{%endif%}		
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"><i class="icon-th-list"></i></span>
					<h5></h5>
					{%if not parent_id%}
					<div class="widget-title-option">
						<a href="{%url 'suppliers' org.pk%}" class="btn btn-primary">{%trans '返回供货商列表'%}</a>
						{%if supplier%}
						<a href="javascript:void(0)" tag="{{supplier.pk}}" tag_name="{{supplier}}" id="del_supplier" class="btn btn-warning">{%trans '删除'%}</a>
						{%endif%}
					</div>
					{%endif%}
				</div>
				<div class="widget-content">
					
						<form class="form-horizontal form-min-horizontal" action="" method="POST">{%csrf_token%}
							<div id="lresult" class="lresult"></div>
							<table class="table table-striped noborderd mini-form-table" style="width: auto;">
								<tr>
									<td>
										<div class="control-group {%if form.name.errors%}error{%endif%}">
											<label class="control-label" for="{{form.name.auto_id}}">{%if form.name.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.name.label}}</label>
											<div class="controls">
												{{form.name}}
												<p class="help-block">{{form.name.help_text}}</p>
												<p class="help-block">{{form.name.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.abbreviation.errors%}error{%endif%}">
											<label class="control-label" for="{{form.abbreviation.auto_id}}">{%if form.abbreviation.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.abbreviation.label}}</label>
											<div class="controls">
												{{form.abbreviation}}
												<p class="help-block">{{form.abbreviation.help_text}}</p>
												<p class="help-block">{{form.abbreviation.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.group.errors%}error{%endif%}">
											<label class="control-label" for="{{form.group.auto_id}}">{%if form.group.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.group.label}}</label>
											<div class="controls">
												{{form.group}}
												<p class="help-block">{{form.abbreviation.help_text}}</p>
												<p class="help-block">{{form.abbreviation.errors}}</p>
											</div>						
										</div>
									</td>
								</tr>
								
								<tr>
									<td colspan="3">
										<div class="control-group {%if form.address.errors%}error{%endif%}">
											<label class="control-label" for="{{form.address.auto_id}}">{%if form.address.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.address.label}}</label>
											<div class="controls">
												<div class="row-fluid" style="margin-bottom:10px;{%if STYLE == "inventory_en"%}display:none{%endif%}">
											 		<select id="{{form.province.auto_id}}" class="span4" name="{{form.province.html_name}}"></select>
								    				<select id="{{form.city.auto_id}}" class="span4" name="{{form.city.html_name}}"></select>
								    				<select id="{{form.district.auto_id}}" class="span4" name="{{form.district.html_name}}"></select>
											 	</div>
												{{form.address}}
												<p class="help-block">{{form.address.help_text}}</p>
												<p class="help-block">{{form.address.errors}}</p>
											</div>						
										</div>
									</td>
								</tr>
								
								<tr>
									<td>
										<div class="control-group {%if form.tax.errors%}error{%endif%}">
											<label class="control-label" for="{{form.tax.auto_id}}">{%if form.tax.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.tax.label}}</label>
											<div class="controls">
												{{form.tax}}
												<p class="help-block">{{form.tax.help_text}}</p>
												<p class="help-block">{{form.tax.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.account.errors%}error{%endif%}">
											<label class="control-label" for="{{form.account.auto_id}}">{%if form.account.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.account.label}}</label>
											<div class="controls">
												{{form.account}}
												<p class="help-block">{{form.account.help_text}}</p>
												<p class="help-block">{{form.account.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.bank.errors%}error{%endif%}">
											<label class="control-label" for="{{form.bank.auto_id}}">{%if form.bank.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.bank.label}}</label>
											<div class="controls">
												{{form.bank}}
												<p class="help-block">{{form.bank.help_text}}</p>
												<p class="help-block">{{form.bank.errors}}</p>
											</div>						
										</div>
									</td>
								</tr>
								
								<tr>
									<td colspan="3">
										<div class="control-group {%if form.invoice_address.errors%}error{%endif%}">
											<label class="control-label" for="{{form.invoice_address.auto_id}}">{%if form.invoice_address.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.invoice_address.label}}</label>
											<div class="controls">
												{{form.invoice_address}}
												<p class="help-block">{{form.invoice_address.help_text}}</p>
												<p class="help-block">{{form.invoice_address.errors}}</p>
											</div>						
										</div>
									</td>
								</tr>
								
								<tr>
									<td>
										<div class="control-group {%if form.contact.errors%}error{%endif%}">
											<label class="control-label" for="{{form.contact.auto_id}}">{%if form.contact.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.contact.label}}</label>
											<div class="controls">
												{{form.contact}}
												<p class="help-block">{{form.contact.help_text}}</p>
												<p class="help-block">{{form.contact.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.email.errors%}error{%endif%}">
											<label class="control-label" for="{{form.email.auto_id}}">{%if form.email.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.email.label}}</label>
											<div class="controls">
												{{form.email}}
												<p class="help-block">{{form.email.help_text}}</p>
												<p class="help-block">{{form.email.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.zip_code.errors%}error{%endif%}">
											<label class="control-label" for="{{form.zip_code.auto_id}}">{%if form.zip_code.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.zip_code.label}}</label>
											<div class="controls">
												{{form.zip_code}}
												<p class="help-block">{{form.zip_code.help_text}}</p>
												<p class="help-block">{{form.zip_code.errors}}</p>
											</div>						
										</div>
									</td>
								</tr>
								
								<tr>
									<td>
										<div class="control-group {%if form.tel.errors%}error{%endif%}">
											<label class="control-label" for="{{form.tel.auto_id}}">{%if form.tel.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.tel.label}}</label>
											<div class="controls">
												{{form.tel}}
												<p class="help-block">{{form.tel.help_text}}</p>
												<p class="help-block">{{form.tel.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.phone.errors%}error{%endif%}">
											<label class="control-label" for="{{form.phone.auto_id}}">{%if form.phone.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.phone.label}}</label>
											<div class="controls">
												{{form.phone}}
												<p class="help-block">{{form.phone.help_text}}</p>
												<p class="help-block">{{form.phone.errors}}</p>
											</div>						
										</div>
									</td>
									<td>
										<div class="control-group {%if form.fax.errors%}error{%endif%}">
											<label class="control-label" for="{{form.fax.auto_id}}">{%if form.fax.field.required%}<i class="icon icon-asterisk"></i>{%endif%}{{form.fax.label}}</label>
											<div class="controls">
												{{form.fax}}
												<p class="help-block">{{form.fax.help_text}}</p>
												<p class="help-block">{{form.fax.errors}}</p>
											</div>						
										</div>
									</td>
								</tr>

								<tr>
								<td>
								<div class="span3">
			             	    <div class="control-group {%if form.sstatus.errors%}error{%endif%}">
			             		<label class="control-label" for="{{form.remark.auto_id}}">备注：</label>
			             		<div class="controls">
			                            {{form.remark}}
			                         </div> 
			             	</div>
			             </div>
			             </td>
								</tr>
								
							</table>
						
							{%if not view%}
							<div class="form-actions">
									<button type="submit" class="btn btn-primary">{%trans '保存'%}</button>
									<button type="reset" class="btn btn-success">{%trans '重置'%}</button>
									<!--input type="hidden" name="neww" id="neww" value="0" />
									<input type="button" class="btn btn-primary" onclick="$('#neww').val('1');$('#in_custome_form').submit();"  value="{%trans '保存并继续'%}" /-->
							</div>
							{%endif%}
						</form>
						{{form.errors}}
				</div>
			</div>
	{%if not parent_id%}		
		</div>
	</div>
	
	<div class="f-left">
		<div class="left-wrap">
			{%include "parts/info_left_nav.html"%}
		</div>
	</div>
	{%endif%}
	<!--div class="f-right">
		<div class="right-wrap">
			
		</div>
	</div-->
</div>
{%endblock%}

{%block endrel%}
<script type="text/javascript" src="/static/js/helper/tdist_py.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	$('#settings_ghs').addClass('current');	
	$('#tab-setting').addClass('active');

	{%if success%}
	$('#{{parent_id}}',parent.document).append("<option selected='selected' value='{{form.instance.pk}}'>{{form.instance.name}}</option>")
	var index = parent.layer.getFrameIndex(window.name);
	parent.layer.close(index);
	{%endif%}

	$('#del_supplier').click(function(){
		if(!confirm("{%trans '确定要删除'%}"+$(this).attr('tag_name')+"{%trans '，如果供货商已有单据，将禁止删除？'%}")){
			return false;
		}
		$.ajax({
			url:"{%url 'supplier_delete' org.pk %}",
			type:'POST',
			data:{'del_supplier_id':$(this).attr('tag')},
			error:function(){
				alert("{%trans '操作失败'%}");
			},
			success:function(text){
				if(parseInt(text)){
					location.href="{%url 'suppliers' org.pk%}";
				}else{
					alert(text);
				}
			}
		});
	});

	strChineseFirstPY=null;
	oMultiDiff=null;

	$.getJSON('/static/js/pinyin.js',function(json){
		strChineseFirstPY=json['strChineseFirstPY'];
		oMultiDiff=json['oMultiDiff'][0];
	});


	$('#{{form.name.auto_id}}').focus(function(){
		$('#lresult').hide();
	}).blur(function(){
		var str=$('#{{form.name.auto_id}}').val().trim();
		var arrRslt=makePy(str);
		$('#lresult').html("<div>&nbsp;" + arrRslt.join("</div><div>&nbsp;") +
				"</div><div align='center'></div>").
				css({'top':($('#{{form.abbreviation.auto_id}}').position().top+30),'left':$('#{{form.abbreviation.auto_id}}').position().left});

		divs=$('#lresult div');
		for(var i=0;i<divs.length;i++){
			divs[i].className = i%2 ? "divShuang" : "divDan";
			if(i>1){
				$('#lresult').css({'display':'block'});
			}
		}
		$('#{{form.abbreviation.auto_id}}').val(divs.eq(0).text());
	});;
	
	$('#{{form.abbreviation.auto_id}}').click(function(){
		if($('#lresult').is(":visible")){
			$('#lresult').hide();
			return;
		}
		var str=$('#{{form.name.auto_id}}').val().trim();
		if(str=="") return;

		var arrRslt=makePy(str);
		$('#lresult').html("<div>&nbsp;" + arrRslt.join("</div><div>&nbsp;") +
				"</div><div align='center'></div>").
				css({'top':($(this).position().top+30),'left':$(this).position().left});

		divs=$('#lresult div');
		for(var i=0;i<divs.length;i++){
			divs[i].className = i%2 ? "divShuang" : "divDan";
			if(i>1){
				$('#lresult').css({'display':'block'});
			}
		}
		
	}).blur(function(){$('#lresult').hide();});

	$('#lresult').on('click','div',function(){
		$('#{{form.abbreviation.auto_id}}').val($(this).text());
		$('#lresult').hide();
	});

	//初始化城市选择
	$('#{{form.district.auto_id}}').change(function(){
		var citys=getlist_select($(this).val());
		$('#{{form.area.auto_id}}').empty().append(citys).change();

		if(citys){
			$('#{{form.area.auto_id}}').show();
		}else{
			$('#{{form.area.auto_id}}').hide();
		}
	});
	
	$('#{{form.city.auto_id}}').change(function(){
		var citys=getlist_select($(this).val());
		$('#{{form.district.auto_id}}').empty().append(citys).change();

		if(citys){
			$('#{{form.district.auto_id}}').show();
		}else{
			$('#{{form.district.auto_id}}').hide();
		}
	});
	
	provices=getlist_select("1");
	$('#{{form.province.auto_id}}').change(function(){
		if($(this).val()=="990000"){
			var citys=getlist_select("0");
		}else{
			var citys=getlist_select($(this).val());
		}
		
		$('#{{form.city.auto_id}}').empty().append(citys).change();
	}).empty().append(provices);


	{%if form.instance.pk%}
	$('#{{form.province.auto_id}}').val("{{form.instance.province.pk}}").change();
	$('#{{form.city.auto_id}}').val("{{form.instance.city.pk}}").change();

	{%if form.instance.district%}
	$('#{{form.district.auto_id}}').val("{{form.instance.district.pk}}");
	{%endif%}

	
	{%else%}
	$('#{{form.province.auto_id}}').change();
	{%endif%}
});
function getlist(key){
	var clist=[];
	for(var _key in tdist_all){
		if(tdist_all[_key][1]==key){
			clist.append(tdist_all[_key][0],_key);
		}
	}
	return clist;
}

function getlist_select(key){
	var clist="";
	for(var _key in tdist_all){
		if(tdist_all[_key][1]==key){
			if(_key!=1){
				clist+="<option value='"+_key+"'>"+tdist_all[_key][0]+(key=="0"?tdist_all[_key][2]:"")+"</option>";
			}
		}
	}
	return clist;
}
</script>
{%endblock%}